<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<style type="text/css">
		.buttons {
			position: absolute;
			right: 0;
		}.buttons button{
			border: 0;
			background: #c12;
			color: #fff;
			padding: 4px 10px;
			border-radius: 4px;
		}
		.start {
			background: #affaaf;
		}.visited {
			background: #af0af4;
		}.walked {
			background: rgba(208, 169, 4, 0.59);
		}.end {
			background: #fa0a0a;
		}
		.path {
			background: #fa3b4c;
		}
		.anchor{
			background: #000 !important;
			color: #fff !important;
		}
		.anchor label{
			color: #fff !important;
		}
		visited {
			position: absolute;
			left:0;
			top:0;
			width:100%;
			height: 100%;
			background: rgba(219, 0, 0, 0.08);
			animation-name: example;
  			animation-duration: 2s;
		}
		label {
			position: relative;
			color: #000;
			font-size:10px;
		}
		@keyframes example {
		  0%   {background-color: rgba(74, 197, 74, 0.55); border-radius: 50%;}
		  25%  {background-color: rgba(167, 197, 74, 0.55);border-radius: 35%;}
		  50%  {background-color: rgba(197, 131, 94, 0.65);border-radius: 20%;}
		  100% {background: rgba(219, 0, 0, 0.44);border-radius: 0%;}
		}
	</style>
</head>
<body>
<div id="container">
	<div class="col buttons">
		<button id="Random Walk" onclick="random_walk(g, [5,9])">Random Walk</button>
		<button id="Shortest Path" onclick="bfs(g, [5,9])">Shortest Path</button>
	</div>
</div>
</body>
<script>
	let start = [5,9];
	let anchors = [];
	let stop = false;

	let grid = function create_grid(rows, columns, cell_width, start, stop) {
		grid_ = []
		id = 1;
		for(i = 0; i < rows; i++) {
			for (j = 0; j < columns; j++) {

				node = $('<div class="node" id="'+id+'" data-loc="'+i+'|'+j+'"></div>');
				node.append('<label>'+id+'<label>');
				node.css({'position':'absolute', 'left':j * cell_width + 'px', 'top': i*cell_width + 'px', 'border' : '#aaa solid 1px', 'width' : cell_width+'px', 'height' : cell_width+'px'});
				if(start[0] == i && start[1] == j) {
					node.addClass('start');
				}if(stop[0] == i && stop[1] == j) {
					node.addClass('end');
				}

				grid_.push(node);
				$('#container').append(node);

				id = i * columns + j + 2;
			}
		}

		$('.node').on('click', function() {
			loc = $(this).attr('data-loc');
			if(anchors.includes(loc)) {
				$(this).removeClass('anchor');
				const index = anchors.indexOf(loc);
				if (index > -1) {
				  anchors.splice(index, 1);
				}
			}
			else {
				anchors.push(loc);
				$(this).addClass('anchor');
			}
		});

		return grid_;

	}
	var random_walk = function(grid, start_pos) {
		var walk = [];

		while(!stop) {
			list = [];
			if(start_pos[0]-1 >= 0)
			{
				list.push([start_pos[0] - 1, start_pos[1]]);
			}
			if(start_pos[1] - 1 > 0)
			{
				list.push([start_pos[0], start_pos[1] - 1]);
			}
			if(start_pos[0] + 1 < 20)
			{
				list.push([start_pos[0] + 1, start_pos[1]]);
			}
			if(start_pos[1] + 1 <= 30)
			{
				list.push([start_pos[0], start_pos[1] + 1]);
			}

			list = list.filter(value => !anchors.includes(value[0] + '|' + value[1]))
			if(list.length <= 0) {
				alert('No position left');
				clearInterval(intId);
				stop = True
				break;
			}
			else {
				walk.push(start_pos);
				start_pos = list[Math.floor(Math.random()*list.length)];
				id = start_pos[0] * 30 + start_pos[1];
				if($('#'+id).hasClass("end")) {
					break;
				}
			}
			
		}
		var intId = setInterval(function() {

			if(walk.length <= 0) {
				clearInterval(intId);
				return;
			}

			v = walk.shift();
			id = v[0] * 30 + v[1];
			$('#'+id).append('<visited></visited>');
		}, 40);
	}
	var bfs = function(grid, start_pos) {
		queue = [start_pos];
		visited = {};
		visited[start_pos] = true;
		trav = []

		var intId = setInterval(function() {
			if(queue.length <= 0) {
				clearInterval(intId);
			}

			start_pos = queue.shift();

			ud_ = start_pos[0] * 30 + start_pos[1];
			trav.push(ud_);

			if(visited.length > 500 || $('#'+ud_).hasClass("end")) {
				clearInterval(intId);
				return;
			}


			if(start_pos) {
				neighbours = [];
				neighbours.push([start_pos[0] - 1, start_pos[1]]);
				neighbours.push([start_pos[0] + 1, start_pos[1]]);
				neighbours.push([start_pos[0], start_pos[1]-1]);
				neighbours.push([start_pos[0], start_pos[1]+1]);
			}

			neighbours = neighbours.filter(value => !anchors.includes(value[0] + '|' + value[1]))
			
			$.each(neighbours, function(k,v) {
				if(v[0] >= 0 && v[1] > 0 && v[0] < 20 && v[1] <= 30) {
					if(!visited[v]) {
						id = v[0] * 30 + v[1];
						$('#'+id).addClass('visited');
						queue.push(v);
						visited[v] = true;
					}
				}
			});
		}, 10);

	}

	g = grid(20, 30, 35, [5,8], [19,12]);
</script>
</html>
